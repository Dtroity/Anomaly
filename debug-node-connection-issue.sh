#!/bin/bash
# –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –Ω–æ–¥–µ

echo "üîç –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –Ω–æ–¥–µ"
echo "===================================================="
echo ""

NODE_IP="185.126.67.67"

echo "üìã –í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞ Node Server (185.126.67.67):"
echo ""
echo "1Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞, –º–æ–∂–µ—Ç –ª–∏ –Ω–æ–¥–∞ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ:"
echo "   docker exec anomaly-node python3 -c \""
echo "   import urllib.request, ssl"
echo "   ssl_context = ssl.create_default_context()"
echo "   ssl_context.check_hostname = False"
echo "   ssl_context.verify_mode = ssl.CERT_NONE"
echo "   try:"
echo "       req = urllib.request.Request('https://localhost:62050/')"
echo "       with urllib.request.urlopen(req, timeout=5, context=ssl_context) as resp:"
echo "           print(f'SUCCESS: {resp.getcode()}')"
echo "   except Exception as e:"
echo "       print(f'ERROR: {str(e)}')"
echo "   \""
echo ""
echo "2Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–æ–¥—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–≤–æ –≤—Ä–µ–º—è –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è):"
echo "   docker logs -f anomaly-node"
echo "   (–ó–∞—Ç–µ–º –Ω–∞ Control Server –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: ./test-node-from-control.sh)"
echo ""
echo "3Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞, –∫–∞–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —Å–ª—É—à–∞—é—Ç –Ω–∞ –ø–æ—Ä—Ç—É 62050:"
echo "   netstat -tlnp | grep 62050"
echo "   –∏–ª–∏"
echo "   ss -tlnp | grep 62050"
echo ""
echo "4Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ firewall:"
echo "   ufw status"
echo "   –∏–ª–∏"
echo "   iptables -L -n | grep 62050"
echo ""
echo "5Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω marzban-node:"
echo "   docker exec anomaly-node env | grep -E 'UVICORN|SERVICE|SSL'"
echo ""
echo "6Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ marzban-node:"
echo "   docker exec anomaly-node python3 -c \"import marzban_node; print(marzban_node.__version__)\" 2>/dev/null || \\"
echo "   docker exec anomaly-node cat /app/version.txt 2>/dev/null || \\"
echo "   docker exec anomaly-node ls -la /app/ | head -10"
echo ""
echo "üí° –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:"
echo "   1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é marzban-node: https://github.com/gozargah/marzban-node"
echo "   2. –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª (–Ω–µ REST)"
echo "   3. –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è"
echo "   4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–µ—Ä—Å–∏—è marzban-node —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å –≤–µ—Ä—Å–∏–µ–π Marzban –Ω–∞ Control Server"
echo ""

