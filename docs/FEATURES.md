# üöÄ –§—É–Ω–∫—Ü–∏–∏ Anomaly Connect

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. üí≥ –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –ø–ª–∞—Ç–µ–∂–µ–π

**–§–∞–π–ª—ã:**
- `vpnbot/services/payment_provider.py` - –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
- `vpnbot/api_payments.py` - API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã:**
- ‚úÖ –ÆKassa (–æ—Å–Ω–æ–≤–Ω–æ–π)
- ‚úÖ Telegram Payments
- ‚úÖ –ö—Ä–∏–ø—Ç–æ–ø–ª–∞—Ç–µ–∂–∏ (–±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
- –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### 2. üéÅ Free/Trial —Ä–µ–∂–∏–º

**–§–∞–π–ª—ã:**
- `vpnbot/services/trial_service.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º
- `vpnbot/models.py` - –º–æ–¥–µ–ª—å `TrialAccess`

**–§—É–Ω–∫—Ü–∏–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã–¥–∞—á–∞ –ø—Ä–æ–±–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∞ –Ω–∞ –ø—Ä–æ–±–Ω—ã–π –¥–æ—Å—Ç—É–ø (–æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–¥–Ω–∏, —Ç—Ä–∞—Ñ–∏–∫)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Marzban

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
```env
FREE_TRIAL_DAYS=7
FREE_TRIAL_TRAFFIC_GB=5
```

### 3. üìä –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

**–§–∞–π–ª—ã:**
- `vpnbot/services/analytics_enhanced.py` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- `vpnbot/handlers/admin.py` - –∫–æ–º–∞–Ω–¥—ã `/admin` –∏ `/stats`

**–ú–µ—Ç—Ä–∏–∫–∏:**
- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–∏
- –î–æ—Ö–æ–¥ –ø–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º
- –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–¥
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è (trial ‚Üí paid)
- –û—Ç—Ç–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏

### 4. üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª—ã:**
- `vpnbot/services/logging_service.py` - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `vpnbot/models.py` - –º–æ–¥–µ–ª—å `SystemLog`

**–¢–∏–ø—ã –ª–æ–≥–æ–≤:**
- –ü–ª–∞—Ç–µ–∂–∏ (created, completed, failed)
- API –∑–∞–ø—Ä–æ—Å—ã
- –î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–æ–±—ã—Ç–∏—è –Ω–æ–¥
- –û—à–∏–±–∫–∏

**–•—Ä–∞–Ω–µ–Ω–∏–µ:**
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (`system_logs`)
- –§–∞–π–ª—ã (`vpnbot/logs/`)

### 5. üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª—ã:**
- `backup.sh` - —Å–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞
- `setup-cron.sh` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á

**–ß—Ç–æ –±—ç–∫–∞–ø–∏—Ç—Å—è:**
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL (—Å–∂–∞—Ç–∞—è)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (.env)
- –õ–æ–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:**
- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±—ç–∫–∞–ø –≤ 3:00 AM
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (30+ –¥–Ω–µ–π)

### 6. üîß –£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–§–∞–π–ª—ã:**
- `vpnbot/config.py` - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ù–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—Ä–∏–ø—Ç–æ–ø–ª–∞—Ç–µ–∂–µ–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ trial —Ä–µ–∂–∏–º–∞
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 7. üéØ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –±–æ—Ç–∞

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `vpnbot/handlers/user.py` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ trial —Ä–µ–∂–∏–º–∞
- `vpnbot/handlers/admin.py` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–±–Ω—ã–π –¥–æ—Å—Ç—É–ø"
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ `/admin`
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤ `/stats`

## üìã –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

1. **`trial_access`**
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–Ω—ã–º–∏ –¥–æ—Å—Ç—É–ø–∞–º–∏
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

2. **`system_logs`**
   - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ü–æ–∏—Å–∫ –ø–æ —Ç–∏–ø—É, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –¥–∞—Ç–µ

3. **`user_sessions`**
   - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–µ—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ú–µ—Ç—Ä–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

1. **`payments`**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `provider_payment_id` (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π ID)
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `crypto_tx_hash` (–¥–ª—è –∫—Ä–∏–ø—Ç–æ–ø–ª–∞—Ç–µ–∂–µ–π)
   - –†–∞—Å—à–∏—Ä–µ–Ω—ã —Å—Ç–∞—Ç—É—Å—ã (PROCESSING, REFUNDED)

2. **`users`**
   - –£–ª—É—á—à–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ trial/free —Ä–µ–∂–∏–º–∞

## üîÑ –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–±–Ω—ã–π –¥–æ—Å—Ç—É–ø:
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–±–Ω—ã–π –¥–æ—Å—Ç—É–ø"
   ‚Üì
2. TrialService –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ –¥–æ—Å—Ç—É–ø
   ‚Üì
3. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ trial_access
   ‚Üì
4. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (—Ä–æ–ª—å, —Å—Ä–æ–∫, —Ç—Ä–∞—Ñ–∏–∫)
   ‚Üì
5. –°–æ–∑–¥–∞–µ—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ Marzban
   ‚Üì
6. –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏–µ
```

### –ü–ª–∞—Ç–µ–∂:
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∞—Ä–∏—Ñ
   ‚Üì
2. PaymentService —Å–æ–∑–¥–∞–µ—Ç –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
   ‚Üì
3. –ü–ª–∞—Ç–µ–∂ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î (PENDING)
   ‚Üì
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç
   ‚Üì
5. Webhook –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
   ‚Üì
6. PaymentService –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç webhook
   ‚Üì
7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ (SUCCESS)
   ‚Üì
8. –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
   ‚Üì
9. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ Marzban
   ‚Üì
10. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
```env
# Trial —Ä–µ–∂–∏–º
FREE_TRIAL_DAYS=7
FREE_TRIAL_TRAFFIC_GB=5

# –ö—Ä–∏–ø—Ç–æ–ø–ª–∞—Ç–µ–∂–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
CRYPTO_WALLET_ADDRESS=
CRYPTO_NETWORK=TRC20
```

### 2. –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron

```bash
chmod +x setup-cron.sh
sudo ./setup-cron.sh
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `docs/PAYMENT_SYSTEM.md` - –¥–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- `docs/FEATURES.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª
- `README.md` - –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

1. **–í–µ–±-–ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞**
   - –î–∞—à–±–æ—Ä–¥ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞—Ä–∏—Ñ–æ–≤

2. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
   - Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–ª–∞—Ç–µ–∂–∞—Ö
   - Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞–º

3. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫
   - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏

4. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞**
   - –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 2024

