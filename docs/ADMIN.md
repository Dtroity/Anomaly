# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ Anomaly VPN

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ù–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#–Ω–∞—á–∞–ª—å–Ω–∞—è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
2. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)
3. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞–º–∏](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Ç–∞—Ä–∏—Ñ–∞–º–∏)
4. [–ü–ª–∞—Ç–µ–∂–∏ –∏ —Ñ–∏–Ω–∞–Ω—Å—ã](#–ø–ª–∞—Ç–µ–∂–∏-–∏-—Ñ–∏–Ω–∞–Ω—Å—ã)
5. [–ê–Ω–∞–ª–∏—Ç–∏–∫–∞](#–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
6. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
7. [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)

## üöÄ –ù–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env —Ñ–∞–π–ª**
   ```bash
   nano /opt/anomaly-vpn/.env
   ```

2. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
   - `BOT_TOKEN` - —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
   - `ADMIN_IDS` - ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
   - `MARZBAN_API_URL` - URL –ø–∞–Ω–µ–ª–∏ Marzban
   - `MARZBAN_USERNAME` - –ª–æ–≥–∏–Ω Marzban
   - `MARZBAN_PASSWORD` - –ø–∞—Ä–æ–ª—å Marzban
   - `YOOKASSA_SHOP_ID` - ID –º–∞–≥–∞–∑–∏–Ω–∞ –ÆKassa
   - `YOOKASSA_SECRET_KEY` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –ÆKassa
   - `APP_URL` - URL –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:**
   ```bash
   cd /opt/anomaly-vpn
   sudo bash start.sh
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É:**
   ```bash
   docker-compose ps
   docker-compose logs -f
   ```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

1. –ü–æ–ª—É—á–∏—Ç–µ —Å–≤–æ–π Telegram ID (—á–µ—Ä–µ–∑ [@userinfobot](https://t.me/userinfobot))
2. –î–æ–±–∞–≤—å—Ç–µ ID –≤ `ADMIN_IDS` –≤ `.env`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `docker-compose restart vpnbot`
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/admin` –±–æ—Ç—É

## üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### –í—ã–¥–∞—á–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

**–ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É:**
```
/grant <telegram_id> <–¥–Ω–∏> <—Ç—Ä–∞—Ñ–∏–∫_gb>
```

**–ü—Ä–∏–º–µ—Ä:**
```
/grant 123456789 30 100
```

**–ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:**
1. `/admin` ‚Üí "üéÅ –í—ã–¥–∞—Ç—å –¥–æ—Å—Ç—É–ø"
2. –í–≤–µ–¥–∏—Ç–µ Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –£–∫–∞–∂–∏—Ç–µ —Å—Ä–æ–∫ –∏ —Ç—Ä–∞—Ñ–∏–∫

### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É:**
```
/revoke <telegram_id>
```

**–ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:**
1. `/admin` ‚Üí "üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å"
2. –í–≤–µ–¥–∏—Ç–µ Telegram ID

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ö–æ–º–∞–Ω–¥–∞:**
```
/admin ‚Üí üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
```

–ò–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ):
```
/users
```

### –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- **ADMIN** - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø)
- **USER** - –ø–ª–∞—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- **PROMO** - –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- **BANNED** - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω

## üí≥ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞–º–∏

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞

–¢–∞—Ä–∏—Ñ—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ. –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
   ```bash
   docker-compose exec db psql -U anomaly -d anomaly
   ```

2. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ—ã:
   ```sql
   SELECT * FROM subscription_plans;
   ```

3. –û–±–Ω–æ–≤–∏—Ç–µ —Ç–∞—Ä–∏—Ñ:
   ```sql
   UPDATE subscription_plans 
   SET price = 399.0, traffic_limit_gb = 150 
   WHERE id = 1;
   ```

### –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ç–∞—Ä–∏—Ñ–∞

```sql
UPDATE subscription_plans SET is_active = false WHERE id = 1;
```

## üí∞ –ü–ª–∞—Ç–µ–∂–∏ –∏ —Ñ–∏–Ω–∞–Ω—Å—ã

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–ß–µ—Ä–µ–∑ –±–æ—Ç–∞:**
```
/admin ‚Üí üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```

–ò–ª–∏ –∫–æ–º–∞–Ω–¥–∞:
```
/stats
```

**–ú–µ—Ç—Ä–∏–∫–∏:**
- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏
- –î–æ—Ö–æ–¥ –∑–∞ –ø–µ—Ä–∏–æ–¥
- –í—ã–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–æ

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–∞—Ç–µ–∂–µ–π

–ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Üí –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ÆKassa

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [yookassa.ru](https://yookassa.ru/)
2. –°–æ–∑–¥–∞–π—Ç–µ –º–∞–≥–∞–∑–∏–Ω
3. –ü–æ–ª—É—á–∏—Ç–µ Shop ID –∏ Secret Key
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook: `https://your-domain.com/webhook/yookassa`
5. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
   ```
   YOOKASSA_SHOP_ID=your_shop_id
   YOOKASSA_SECRET_KEY=your_secret_key
   ```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ø–ª–∞—Ç–µ–∂–µ–π
docker-compose logs -f api | grep payment

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ API
curl https://your-domain.com/payment/check/{payment_id}
```

## üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

- **–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –¥–µ–π—Å—Ç–≤—É—é—â–µ–π –ø–æ–¥–ø–∏—Å–∫–æ–π
- **–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏** - –ø–ª–∞—Ç–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏
- **–î–æ—Ö–æ–¥ –∑–∞ 30 –¥–Ω–µ–π** - –æ–±—â–∏–π –¥–æ—Ö–æ–¥ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü
- **–î–æ—Ö–æ–¥ —Å–µ–≥–æ–¥–Ω—è** - –¥–æ—Ö–æ–¥ –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å
- **–ü—Ä–æ–º–æ –≤—ã–¥–∞–Ω–æ** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–º–æ –∑–∞ 30 –¥–Ω–µ–π

### –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

```bash
# –≠–∫—Å–ø–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
docker-compose exec db psql -U anomaly -d anomaly -c "COPY users TO '/tmp/users.csv' CSV HEADER;"

# –≠–∫—Å–ø–æ—Ä—Ç –ø–ª–∞—Ç–µ–∂–µ–π
docker-compose exec db psql -U anomaly -d anomaly -c "COPY payments TO '/tmp/payments.csv' CSV HEADER;"
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü–∞—Ä–æ–ª–∏:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
   - –†–µ–≥—É–ª—è—Ä–Ω–æ –º–µ–Ω—è–π—Ç–µ –ø–∞—Ä–æ–ª–∏
   - –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ

2. **–î–æ—Å—Ç—É–ø:**
   - –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ Marzban
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ firewall –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSH –∫–ª—é—á–∏ –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª–µ–π

3. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   ```bash
   # –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   docker-compose exec db pg_dump -U anomaly anomaly > backup_$(date +%Y%m%d).sql
   
   # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
   docker-compose exec -T db psql -U anomaly anomaly < backup_20240101.sql
   ```

4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
   - –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

```bash
# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
cd /opt/anomaly-vpn
git pull

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose build

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose up -d
```

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:
   ```bash
   docker-compose ps
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
   ```bash
   docker-compose logs vpnbot
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ `.env`

4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
   ```bash
   docker-compose restart vpnbot
   ```

### –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Marzban

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:
   ```bash
   curl -k https://your-marzban-url:62050/api/v1/system
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ `.env`

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall –Ω–∞ VPS #2

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook:
   ```bash
   docker-compose logs api | grep webhook
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ÆKassa –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ `.env` (`APP_URL`)

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:
   ```bash
   docker-compose exec db pg_isready
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
   ```bash
   docker-compose exec db psql -U anomaly -d anomaly -c "SELECT 1;"
   ```

3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ –±—ç–∫–∞–ø–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs -f`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
3. –°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

---

**–í–∞–∂–Ω–æ:** –†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤!

