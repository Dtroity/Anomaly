#!/bin/bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ Xray core –Ω–∞ –Ω–æ–¥–µ

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ Xray core –Ω–∞ –Ω–æ–¥–µ"
echo "================================================="
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–∞ –∫–∞–∫–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∑–∞–ø—É—â–µ–Ω —Å–∫—Ä–∏–ø—Ç
if [ ! -f docker-compose.node.yml ]; then
    echo "‚ö†Ô∏è  –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –Ω–∞ Node Server (VPS #2)"
    exit 1
fi

echo "‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –Ω–æ–¥–∞"
echo ""

echo "1Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ /start –æ—Ç Control Server..."
echo "   üìã –ü–æ–∏—Å–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ /start –≤ –ª–æ–≥–∞—Ö:"
docker logs anomaly-node --tail 500 2>&1 | grep -E "(POST /start|POST /restart|started|Xray.*start)" | tail -20 | sed 's/^/      /' || echo "      ‚ÑπÔ∏è  –ù–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ /start –≤ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ª–æ–≥–∞—Ö"

echo ""
echo "2Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫ Xray core..."
echo "   üìã –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π:"
docker logs anomaly-node --tail 500 2>&1 | grep -i -E "(xray.*error|xray.*fail|invalid.*config|port.*bind|address.*already|permission.*denied)" | tail -30 | sed 's/^/      /' || echo "      ‚ÑπÔ∏è  –ù–µ—Ç —è–≤–Ω—ã—Ö –æ—à–∏–±–æ–∫ Xray –≤ –ª–æ–≥–∞—Ö"

echo ""
echo "3Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏..."
echo "   üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—É—Å–∫–∞ Xray:"
docker logs anomaly-node --tail 200 2>&1 | grep -E "(connected|POST /connect|POST /start|POST /restart|Xray core|Restarting)" | tail -30 | sed 's/^/      /'

echo ""
echo "4Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Xray –Ω–∞ Control Server..."
echo "   üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Xray –≤ –ø–∞–Ω–µ–ª–∏ Marzban —Å–æ–¥–µ—Ä–∂–∏—Ç:"
echo "      - –•–æ—Ç—è –±—ã –æ–¥–∏–Ω inbound (–Ω–∞–ø—Ä–∏–º–µ—Ä, VMess TCP)"
echo "      - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã (–Ω–µ –∑–∞–Ω—è—Ç—ã–µ –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏)"
echo "      - –í–∞–ª–∏–¥–Ω—ã–π JSON —Ñ–æ—Ä–º–∞—Ç"
echo ""
echo "   üìã –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ –ø–∞–Ω–µ–ª–∏:"
echo "      https://panel.anomaly-connect.online -> Settings -> Xray Config"
echo ""

echo "5Ô∏è‚É£  –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:"
echo "   üí° –ï—Å–ª–∏ Xray core –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:"
echo "      1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Xray –≤ –ø–∞–Ω–µ–ª–∏ Marzban"
echo "      2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ –∑–∞–Ω—è—Ç—ã"
echo "      3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç VMess TCP —Å 443 –Ω–∞ –¥—Ä—É–≥–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 8443)"
echo "      4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–æ–¥—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–ø—É—Å–∫–∞:"
echo "         docker logs -f anomaly-node | grep -E '(start|restart|xray|error)'"
echo ""

