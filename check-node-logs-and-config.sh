#!/bin/bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–æ–¥—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–æ–¥—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"
echo "======================================"
echo ""

NODE_IP="185.126.67.67"

echo "üìã –í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞ Node Server (185.126.67.67):"
echo ""
echo "1Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–æ–¥—ã (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫):"
echo "   docker logs anomaly-node --tail=50"
echo ""
echo "2Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ .env.node:"
echo "   cat .env.node | grep -E 'CONTROL_SERVER_URL|SERVICE_PROTOCOL|UVICORN'"
echo ""
echo "3Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:"
echo "   docker exec anomaly-node env | grep -E 'CONTROL_SERVER|SERVICE_PROTOCOL|UVICORN|SSL'"
echo ""
echo "4Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å–ª—É—à–∞–µ—Ç –ª–∏ –Ω–æ–¥–∞ –Ω–∞ –ø–æ—Ä—Ç—É 62050:"
echo "   docker exec anomaly-node netstat -tlnp | grep 62050 || ss -tlnp | grep 62050"
echo ""
echo "5Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:"
echo "   docker exec anomaly-node ls -la /var/lib/marzban-node/ssl/certificate.pem"
echo "   docker exec anomaly-node ls -la /var/lib/marzban-node/node-certs/certificate.pem"
echo "   docker exec anomaly-node ls -la /var/lib/marzban-node/node-certs/key.pem"
echo ""
echo "6Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞, –º–æ–∂–µ—Ç –ª–∏ –Ω–æ–¥–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Control Server:"
echo "   docker exec anomaly-node python3 -c \""
echo "   import urllib.request, ssl"
echo "   ssl_context = ssl.create_default_context()"
echo "   ssl_context.check_hostname = False"
echo "   ssl_context.verify_mode = ssl.CERT_NONE"
echo "   try:"
echo "       req = urllib.request.Request('https://panel.anomaly-connect.online:62050/')"
echo "       with urllib.request.urlopen(req, timeout=5, context=ssl_context) as resp:"
echo "           print(f'SUCCESS: {resp.getcode()}')"
echo "   except Exception as e:"
echo "       print(f'ERROR: {str(e)}')"
echo "   \""
echo ""
echo "üí° –ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π:"
echo "   ssh root@$NODE_IP 'cd /opt/Anomaly && docker logs anomaly-node --tail=50 && echo \"---\" && cat .env.node | grep -E \"CONTROL_SERVER_URL|SERVICE_PROTOCOL|UVICORN\" && echo \"---\" && docker exec anomaly-node env | grep -E \"CONTROL_SERVER|SERVICE_PROTOCOL|UVICORN|SSL\"'"
echo ""

