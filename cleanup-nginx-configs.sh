#!/bin/bash

# –û—á–∏—Å—Ç–∫–∞ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π Nginx

set -e

echo "üßπ –û—á–∏—Å—Ç–∫–∞ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π Nginx..."
echo ""

cd nginx/conf.d

# –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
rm -f default-http.conf 2>/dev/null || true

# –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ default.conf (HTTP –≤–µ—Ä—Å–∏—è)
if [ -f default.conf ] && [ -f default-http-only.conf ]; then
    # –ï—Å–ª–∏ default.conf —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å default-http-only.conf
    # –ù–æ –ª—É—á—à–µ –æ—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ –∫–∞–∫ —à–∞–±–ª–æ–Ω
    echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è"
fi

# –ü–æ–∫–∞–∑–∞—Ç—å —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å
echo "üìã –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:"
ls -la

cd ../..

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Nginx
echo ""
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Nginx..."
docker-compose restart nginx

sleep 3

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
echo ""
echo "üìã –õ–æ–≥–∏ Nginx (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å—Ç—Ä–æ–∫):"
docker-compose logs --tail=10 nginx

echo ""
echo "‚úÖ –ì–æ—Ç–æ–≤–æ!"

